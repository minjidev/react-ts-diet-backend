/* eslint-disable no-restricted-syntax */
let recipes = [
  {
    recipeId: 0,
    user: 'test@naver.com',
    recipe: {
      id: 'Baked Risotto with Spinach2494.2884717125003',
      label: 'Baked Risotto with Spinach',
      cuisineType: [Array],
      dishType: [Array],
      dietLabels: ['Balanced', 'Low-Carb'],
      healthLabels: [Array],
      image:
        'https://edamam-product-images.s3.amazonaws.com/web-img/5f7/5f7f3ba1158e1da61310e5d280aec85b.jpg?X-Amz-Security-Token=IQoJb3JpZ2luX2VjENb%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLWVhc3QtMSJHMEUCIQD8T5TIagcF%2FWpDTKl%2BhrHeYjtVTlR%2BvAZJ%2FZVGHkD7jwIgfPF54vtMR9RjsEPoDuOb%2FrQ2nGYrb55AlYTIisTKfvMquQUIbhAAGgwxODcwMTcxNTA5ODYiDFC3pvahTC3vuffJaSqWBeOruVaZ1Yf7dcTWKtGs5oIji7G5HBXKqQaTWRBW7jkTKlZC8yVQX5Uk7AA3bnqnnrLknco2VvxhphbIykWFCDLs8zaLXUHQinkRcYHKK8ZcxMwJFou%2BFHbj%2Bxq9SMbSPKMqjwNTxmmErtw4spTII%2BNmg1L0Nm%2BjSUvTi%2BmXN9KjeDjjZqCLsA%2FRByIZ%2FciTPqhRtgGoBWm1v%2BmeGirMDZcOR7OEWFpXaFg9rOP32FCw5k5g1J4uQXIz9m0Rg24Y7%2F2UxXVWCWznN76UurnyqFW%2BTFIjhcGYB9V6%2FEs%2BY5%2FXjdip0eheBIa%2BrNtKsO%2FObbqv%2BYnJ64AkmIHzrsR%2FFcak%2BfllLh7oJQFzbBAxkdITJJQvB7fyCXZw2oPxp6eNk7sClbEpA1%2FsndSbsMsbYLXCfDQm3AUyzVKmoQEBDePO7Cj%2FvK%2BdkuNLHrCas5mProqgpOQU1024rtbVS4blcmqjnsT0vNwNgxUhCbM5fG5e%2BALC0FDYnz%2FPcH00V1CfP89MPpyLh7FvWdLuT4aUQ2ts750JR5s17A1dknUZEZHAgCnJQEBo61efm5etOGK2OlAClqz%2FFVNJWdu%2BuzSgJHcbSIWfDM7dLhbNTzEEK1Nfd6P4reGxnWjMcCrENqrIZ6iAEAOQ%2FcFyqIjVeqjt3xXIVX0nvGuZ1mtb8D8xnIm%2Bn1I6D0eO2Ioa52sy2jIIwjZqPYbNyHR5VsaP%2Fb8I7LnaIdifnLbrYpQEzFFmAnpLfQW026wD2c8X1p%2BIUjsP7ZMGWMuSVFNe1VNYnQJYUAMiRU07l9zvivwt0YRsuns%2FECkK240zW3VuTKPyh8G%2FfzSKJis0Aar1ZakFVzW0XmKl8q%2BA402eHf%2BLEpSP9H%2BHHEnXRAkMMKWbjaYGOrEBhjQa%2Fl4VCochiK2SOTrKPujzFSTkMVgn1gBd4Vm8X1XDF6dPMRrj%2FeUhdkFixIRNkuQr7reiwp79fpG4yWv5DCzcuVWB1%2FEVT2Qor0ZUWDwnni1XSUWuATZLdCiov7hXTZwi4lfTq7ka8EOVuCo%2FBomx9qGHYdmCXf81Iu3mNI1jveS6RapFnD3BSjj7fGnzDTDPvqWZRidkEBHORza88bdQVwNnUHxA%2FJTy4%2BwMZ1B6&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Date=20230728T055229Z&X-Amz-SignedHeaders=host&X-Amz-Expires=3600&X-Amz-Credential=ASIASXCYXIIFNG2HAFWY%2F20230728%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Signature=03292570b27a3fb19a8cb488c2dcad39eadeb8c0c71f6c70a020e3813ba9c84f',
      calories: 311,
      servings: 8,
      yield: 8,
      totalDaily: [
        { label: 'Energy', quantity: 22 },
        { label: 'Fat', quantity: 29 },
        { label: 'Carbs', quantity: 19 },
        { label: 'Protein', quantity: 22 },
      ],
      totalNutrients: [
        { label: 'Energy', quantity: 441, unit: 'kcal' },
        { label: 'Fat', quantity: 19, unit: 'g' },
        { label: 'Carbs', quantity: 58, unit: 'g' },
        { label: 'Protein', quantity: 11, unit: 'g' },
      ],
    },
    date: 'Fri Jul 28 2023 00:00:00 GMT 0900 (Korean Standard Time)',
    savedAt: '',
  },
  {
    recipeId: 1,
    user: 'test@naver.com',
    recipe: {
      id: 'Peanut Butter No Bake Cookies5402.981',
      label: 'Peanut Butter No Bake Cookies',
      cuisineType: [Array],
      dishType: [Array],
      dietLabels: ['Balanced', 'High-Fiber'],
      healthLabels: [Array],
      image:
        'https://edamam-product-images.s3.amazonaws.com/web-img/074/07457fef50d639303e0ba6f397b43f09.jpg?X-Amz-Security-Token=IQoJb3JpZ2luX2VjENb%2F%2F%2F%2F%2F%2F%2F%2F%2F%2FwEaCXVzLWVhc3QtMSJHMEUCIQD8T5TIagcF%2FWpDTKl%2BhrHeYjtVTlR%2BvAZJ%2FZVGHkD7jwIgfPF54vtMR9RjsEPoDuOb%2FrQ2nGYrb55AlYTIisTKfvMquQUIbhAAGgwxODcwMTcxNTA5ODYiDFC3pvahTC3vuffJaSqWBeOruVaZ1Yf7dcTWKtGs5oIji7G5HBXKqQaTWRBW7jkTKlZC8yVQX5Uk7AA3bnqnnrLknco2VvxhphbIykWFCDLs8zaLXUHQinkRcYHKK8ZcxMwJFou%2BFHbj%2Bxq9SMbSPKMqjwNTxmmErtw4spTII%2BNmg1L0Nm%2BjSUvTi%2BmXN9KjeDjjZqCLsA%2FRByIZ%2FciTPqhRtgGoBWm1v%2BmeGirMDZcOR7OEWFpXaFg9rOP32FCw5k5g1J4uQXIz9m0Rg24Y7%2F2UxXVWCWznN76UurnyqFW%2BTFIjhcGYB9V6%2FEs%2BY5%2FXjdip0eheBIa%2BrNtKsO%2FObbqv%2BYnJ64AkmIHzrsR%2FFcak%2BfllLh7oJQFzbBAxkdITJJQvB7fyCXZw2oPxp6eNk7sClbEpA1%2FsndSbsMsbYLXCfDQm3AUyzVKmoQEBDePO7Cj%2FvK%2BdkuNLHrCas5mProqgpOQU1024rtbVS4blcmqjnsT0vNwNgxUhCbM5fG5e%2BALC0FDYnz%2FPcH00V1CfP89MPpyLh7FvWdLuT4aUQ2ts750JR5s17A1dknUZEZHAgCnJQEBo61efm5etOGK2OlAClqz%2FFVNJWdu%2BuzSgJHcbSIWfDM7dLhbNTzEEK1Nfd6P4reGxnWjMcCrENqrIZ6iAEAOQ%2FcFyqIjVeqjt3xXIVX0nvGuZ1mtb8D8xnIm%2Bn1I6D0eO2Ioa52sy2jIIwjZqPYbNyHR5VsaP%2Fb8I7LnaIdifnLbrYpQEzFFmAnpLfQW026wD2c8X1p%2BIUjsP7ZMGWMuSVFNe1VNYnQJYUAMiRU07l9zvivwt0YRsuns%2FECkK240zW3VuTKPyh8G%2FfzSKJis0Aar1ZakFVzW0XmKl8q%2BA402eHf%2BLEpSP9H%2BHHEnXRAkMMKWbjaYGOrEBhjQa%2Fl4VCochiK2SOTrKPujzFSTkMVgn1gBd4Vm8X1XDF6dPMRrj%2FeUhdkFixIRNkuQr7reiwp79fpG4yWv5DCzcuVWB1%2FEVT2Qor0ZUWDwnni1XSUWuATZLdCiov7hXTZwi4lfTq7ka8EOVuCo%2FBomx9qGHYdmCXf81Iu3mNI1jveS6RapFnD3BSjj7fGnzDTDPvqWZRidkEBHORza88bdQVwNnUHxA%2FJTy4%2BwMZ1B6&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Date=20230728T055229Z&X-Amz-SignedHeaders=host&X-Amz-Expires=3600&X-Amz-Credential=ASIASXCYXIIFNG2HAFWY%2F20230728%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Signature=dd0ec1afac1523bd0d83be786fb473ed2b6b7a01db95d04ffc50fba76c877382',
      calories: 337,
      servings: 16,
      yield: 16,
      totalDaily: [
        { label: 'Energy', quantity: 22 },
        { label: 'Fat', quantity: 29 },
        { label: 'Carbs', quantity: 19 },
        { label: 'Protein', quantity: 22 },
      ],
      totalNutrients: [
        { label: 'Energy', quantity: 441, unit: 'kcal' },
        { label: 'Fat', quantity: 19, unit: 'g' },
        { label: 'Carbs', quantity: 58, unit: 'g' },
        { label: 'Protein', quantity: 11, unit: 'g' },
      ],
    },
    date: '2023-07-28T05:53:49.869Z',
    savedAt: 1690523567090,
  },
];

const createRecipeId = () =>
  Math.max(...recipes.map((recipe) => recipe.recipeId), 0) + 1;

const createSavedRecipe = (newlySavedRecipe) => {
  recipes = [...recipes, newlySavedRecipe];

  return newlySavedRecipe;
};

const getSavedRecipesByEmail = (email) =>
  recipes.filter((recipe) => recipe.user === email);

const getTotalDaily = ({ recipesByDate, mainNutrients }) => {
  let totalDailyByDate = [];
  for (const savedRecipe of recipesByDate) {
    for (const mainNutrient of mainNutrients) {
      const idx = totalDailyByDate.findIndex(
        (daily) => daily.label === mainNutrient,
      );

      if (idx < 0) {
        totalDailyByDate = [
          ...totalDailyByDate,
          {
            label: mainNutrient,
            quantity: savedRecipe.recipe.totalDaily.find(
              (daily) => daily.label === mainNutrient,
            ).quantity,
          },
        ];
      } else {
        totalDailyByDate[idx].quantity += savedRecipe.recipe.totalDaily.find(
          (daily) => daily.label === mainNutrient,
        ).quantity;
      }
    }
  }

  return totalDailyByDate;
};

const getTotalNutrients = ({ recipesByDate, mainNutrients }) => {
  let totalNutrientsByDate = [];
  for (const savedRecipe of recipesByDate) {
    for (const mainNutrient of mainNutrients) {
      const idx = totalNutrientsByDate.findIndex(
        (daily) => daily.label === mainNutrient,
      );
      if (idx < 0) {
        totalNutrientsByDate = [
          ...totalNutrientsByDate,
          {
            label: mainNutrient,
            quantity: savedRecipe.recipe.totalNutrients.find(
              (daily) => daily.label === mainNutrient,
            ).quantity,
            unit: savedRecipe.recipe.totalNutrients.find(
              (daily) => daily.label === mainNutrient,
            ).unit,
          },
        ];
      } else {
        totalNutrientsByDate[idx].quantity +=
          savedRecipe.recipe.totalNutrients.find(
            (daily) => daily.label === mainNutrient,
          ).quantity;
      }
    }
  }

  return totalNutrientsByDate;
};

const isSameDate = (date1, date2) =>
  date1.getFullYear() === date2.getFullYear() &&
  date1.getMonth() === date2.getMonth() &&
  date1.getDate() === date2.getDate();

const getSavedRecipesByDateandEmail = ({ email, date }) => {
  const mainNutrients = ['Energy', 'Fat', 'Carbs', 'Protein'];

  const recipesByDate = recipes.filter(
    (recipe) =>
      recipe.user === email &&
      isSameDate(new Date(recipe.date), new Date(date)),
  );

  const totalDailyByDate = getTotalDaily({ recipesByDate, mainNutrients });
  const totalNutrientsByDate = getTotalNutrients({
    recipesByDate,
    mainNutrients,
  });

  return {
    recipesByDate,
    totalDailyByDate,
    totalNutrientsByDate,
  };
};

module.exports = {
  recipes,
  createRecipeId,
  createSavedRecipe,
  getSavedRecipesByEmail,
  getSavedRecipesByDateandEmail,
};
